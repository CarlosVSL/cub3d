# **************************************************************************** #
#                                   cub3D                                      #
# **************************************************************************** #

# ----------------------------------------------------------------------------- #
# Configuración general
# ----------------------------------------------------------------------------- #
NAME        := cub3D
SRC_DIR     := src
INC_DIR     := include
OBJ_DIR     := obj
LIBFT_DIR   := libft

# ----------------------------------------------------------------------------- #
# Detección del sistema para MiniLibX
# ----------------------------------------------------------------------------- #
UNAME := $(shell uname)
ifeq ($(UNAME), Darwin)
	MLX_FLAGS := -L /usr/local/lib -lmlx -framework OpenGL -framework AppKit
else
	MLX_FLAGS := -lmlx -lm -lX11 -lXext -lz
endif

# ----------------------------------------------------------------------------- #
# Compilador y flags
# ----------------------------------------------------------------------------- #
CC      := cc
CFLAGS  := -Wall -Wextra -Werror -I$(INC_DIR) -I$(LIBFT_DIR)
AR      := ar
RM      := rm -f
MKDIR_P := mkdir -p

# ----------------------------------------------------------------------------- #
# Fuentes y objetos (recursivo)
# ----------------------------------------------------------------------------- #
SRCS := $(shell find $(SRC_DIR) -name "*.c")
OBJS := $(patsubst $(SRC_DIR)/%.c,$(OBJ_DIR)/%.o,$(SRCS))

# ----------------------------------------------------------------------------- #
# Biblioteca libft
# ----------------------------------------------------------------------------- #
LIBFT := $(LIBFT_DIR)/libft.a

# ----------------------------------------------------------------------------- #
# Regla principal
# ----------------------------------------------------------------------------- #
all: $(NAME)

$(NAME): $(LIBFT) $(OBJ_DIR) $(OBJS)
	$(CC) $(CFLAGS) $(OBJS) $(LIBFT) $(MLX_FLAGS) -o $(NAME)

# ----------------------------------------------------------------------------- #
# Compilación de objetos
# ----------------------------------------------------------------------------- #
$(OBJ_DIR)/%.o: $(SRC_DIR)/%.c
	@$(MKDIR_P) $(dir $@)
	$(CC) $(CFLAGS) -c $< -o $@

# ----------------------------------------------------------------------------- #
# libft
# ----------------------------------------------------------------------------- #
$(LIBFT):
	$(MAKE) -C $(LIBFT_DIR) bonus

# ----------------------------------------------------------------------------- #
# Carpetas auxiliares
# ----------------------------------------------------------------------------- #
$(OBJ_DIR):
	$(MKDIR_P) $(OBJ_DIR)

# ----------------------------------------------------------------------------- #
# Reglas de limpieza
# ----------------------------------------------------------------------------- #
clean:
	$(RM) $(OBJS)
	$(MAKE) -C $(LIBFT_DIR) clean

fclean: clean
	$(RM) $(NAME)
	$(MAKE) -C $(LIBFT_DIR) fclean

re: fclean all

# ----------------------------------------------------------------------------- #
# Bonus (placeholder: el obligatorio ya compila todo)
# ----------------------------------------------------------------------------- #
bonus: all

# ----------------------------------------------------------------------------- #
# Phony
# ----------------------------------------------------------------------------- #
.PHONY: all clean fclean re bonus
